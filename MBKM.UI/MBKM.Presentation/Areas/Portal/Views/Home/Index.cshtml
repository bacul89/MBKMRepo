
@{
    ViewBag.Title = "SIMBKM";
}


<div class="modal fade" id="registrasi" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #FF8A04; ">
                <h5 class="card-title" style="font-weight: bold; font-size: 30px; color: black;">
                    Registrasi Mahasiswa
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </h5>
            </div>
            <div class="modal-body">
                <div id="formRegistrasi">
                    <div class="container" style="width: 100%;">
                        <div class="form-group">
                            <label>Nama Lengkap<h style="color: red;"> *</h></label>
                            <input type="text" name="Nama" id="nama" placeholder="Nama Lengkap" class="form-control input-lg" />
                        </div>
                        <div class="form-group">
                            <label>Tempat Lahir<h style="color: red;"> *</h></label>
                            <input type="text" name="TempatLahir" id="tempatLahir" placeholder="Tempat Lahir" class="form-control input-lg" />
                        </div>
                        <div class="form-group">
                            <label>Tanggal Lahir<h style="color: red;"> *</h></label>
                            <input type="date" name="TanggalLahir" id="tanggalLahir" placeholder="Tanggal Lahir" class="form-control input-lg" value="2000-01-01" />
                        </div>
                        <div class="form-group">
                            <label>Jenis Kelamin</label>
                            <select name="Gender" id="gender" class="form-control input-lg">
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Agama</label>
                            <select name="agama" id="agama" class="form-control input-lg" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Memiliki Kerjasama?</label>
                            <select id="kerjasama" class="form-control input-lg" required>
                                <option value="y">Ya</option>
                                <option value="t">Tidak</option>
                            </select>
                        </div>
                        <div id="univAsal">
                            <div class='form-group'>
                                <label>Universitas Asal</label>
                                <select name='NamaUniversitas' id='namaUniversitas' class='form-control input-lg' required>
                                </select>
                            </div>
                            <div id="noKS">
                                <div class='form-group'>
                                    <label>No. Kerjasama</label>
                                    <select name='noKerjasama' id='noKerjasama' class='form-control input-lg' required>
                                        <option>-- Pilih Nomor Kerjasama --</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Program Studi Universitas Asal</label>
                            <input type="text" name="prodiAsal" id="prodiAsal" placeholder="Program Studi" class="form-control input-lg" />
                        </div>
                        <div class="form-group">
                            <label>Nomor Induk Mahasiswa Asal</label>
                            <input type="text" name="nimAsal" id="nimAsal" placeholder="NIM" class="form-control input-lg" />
                        </div>
                        <div class='form-group'>
                            <label>Tahun Semester</label>
                            <select name='tahunSemester' id='tahunSemester' class='form-control input-lg' required>
                                <option>-- Pilih Tahun Semester --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>No. Handphone<h style="color: red;"> *</h></label>
                            <input type="text" name="NoHp" id="noHp" placeholder="+62xxxxxxxxxxx" class="form-control input-lg" />
                        </div>
                        <div class="form-group">
                            <label>Alamat Email<h style="color: red;"> *</h></label>
                            <input type="Email" name="Email" id="emailRegistrasi" placeholder="someone@somewhere.com" class="form-control input-lg" />
                        </div>
                        <div class="form-group">
                            <label>Password<h style="color: red;"> *</h></label>
                            <input type="password" name="Password" id="passwordRegistrasi" placeholder="●●●●●●●●" class="form-control input-lg" />
                        </div>
                        <div class="form-group">
                            <input onclick="submitRegistrasi()" type="submit" value="Registrasi" class="btn" style="float: right; background-color: #FF8A04; color: black; padding: 5px 30px; font-weight: bold; font-size: 20px;" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div style="padding: 5%;" class="row">
    <div class="col-sm-7 col-md-7 col-lg-7">
        <img style="max-width: 100%;" src="~/Asset/kampus-universitas-katolik-atmajaya-jakarta-_131002231109-118.jpg" />
    </div>
    <div class="col-sm-5 col-md-5 col-lg-5">
        <div class="card" style="width: 100%; background-color: #00FFFF; ">
            <div class="card-body" style="box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2); ">
                <h5 class="card-title" style="background-color: #FF8A04; padding: 15px; font-weight: bold; font-size: 30px; color: black;">LOGIN MAHASISWA</h5>
                <div class="container" style="width: 100%; color: black;">

                    <div style="font-size: 20px; padding: 30px 0px;">
                        Untuk kamu yang sudah registrasi atau Mahasiswa Internal Universitas Katolik Atma Jaya dan ingin mengikuti program studi kampus merdeka, jadwal perkuliahan, dan lainnya, silahkan melakukan Login terlebih dahulu
                    </div>


                    <div class="form-group">
                        <select id="jenisMhs" class="form-control input-lg" required>
                            <option value="y">UAJ</option>
                            <option value="t">Non-UAJ</option>
                        </select>
                    </div>
                    <form action="@Url.Action("LoginInternal", "Home")" id="loginForm" method="post">
                        <div class="form-group">
                            <input type="text" name="username" id="username" placeholder="Nomor Induk Mahasiswa/Student ID" class="form-control input-md" />
                        </div>
                        <div class="form-group">
                            <input type="password" name="password" id="password" placeholder="Password" class="form-control input-md" />
                        </div>
                        <input type="submit" value="Login" class="btn" style="background-color: #FF8A04; color: white; padding: 5px 30px; font-weight: bold; font-size: 20px;" />
                    </form>

                    <hr />
                    <div style="font-size: 20px; padding: 30px 0px;">
                        Untuk kamu yang belum melakukan registrasi dan ingin mengikuti program kampus merdeka, silahkan melakukan
                        <a data-toggle="modal" data-target="#registrasi" style="color: #FF8A04;">Registrasi</a>
                        terlebih dahulu
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script>
        $(document).ready(function () {
            var alertMessage = '@TempData["alertMessage"]';
            if (alertMessage.length != 0) {
                alert(alertMessage);
            }
            loadNamaUniversitas();
            loadNoKerjasama();
            namaUnivOnChange();
            $("#kerjasama").select2({
                width: "100%"
            });
            $("#jenisMhs").select2({
                width: "100%"
            });
            $("#jenisMhs").change(function () {
                if ($("#jenisMhs").val() == "y") {
                    $("#loginForm").attr("action", "@Url.Action("LoginInternal", "Home")");
                    $("#username").attr("placeholder", "Induk Mahasiswa/Student ID");
                } else {
                    $("#loginForm").attr("action", "@Url.Action("LoginExternal", "Home")");
                    $("#username").attr("placeholder", "Email");
                }
            });
            loadFromLookup("TahunSemester", "tahunSemester", "Tahun Semester");
            loadFromLookup("Agama", "agama", "Agama");
            loadFromLookup("Gender", "gender", "Gender");
        });

        $("#kerjasama").change(function () {
            if ($("#kerjasama").val() == "y") {
                $("#univAsal").html("<div class= 'form-group'><label>Universitas Asal</label><select name='NamaUniversitas' id='namaUniversitas' class='form-control input-lg' required></select></div><div id='noKS'><div class='form-group'><label>No. Kerjasama</label><select name='noKerjasama' id='noKerjasama' class='form-control input-lg' required></select></div></div>");
                loadNoKerjasama();
                loadNamaUniversitas();
                namaUnivOnChange();
            } else {
                $("#univAsal").html("<div class= 'form-group'><label>Universitas Asal</label><input type='text' name='NamaUniversitas' id='NamaUniversitas' placeholder='Nama Universitas' class='form-control input-lg' /></div>");
            }
        });

        function namaUnivOnChange() {
            if ($("#kerjasama").val() == "y") {
                $("#namaUniversitas").change(function () {
                    $("#noKS").html("<div class='form-group'><label>No. Kerjasama</label><select name='noKerjasama' id='noKerjasama' class='form-control input-lg' required></select></div>");
                    loadNoKerjasama();
                });
            }
        }
        function submitRegistrasi() {
            if (isEmpty("nama", "Nama lengkap") || isEmpty("tempatLahir", "Tempat lahir") || isEmpty("tanggalLahir", "Tanggal lahir") || isEmpty("noHp", "No. handphone") || isEmpty("emailRegistrasi", "Email") || isEmpty("passwordRegistrasi", "Password")) {
                return;
            }
            mahasiswa = new Object;
            mahasiswa.Nama = $("#nama").val();
            mahasiswa.TempatLahir = $("#tempatLahir").val();
            mahasiswa.TanggalLahir = $("#tanggalLahir").val();
            mahasiswa.Gender = $("#gender").val();
            mahasiswa.Agama = $("#agama").val();
            if ($("#kerjasama").val() == "y") {
                mahasiswa.BiayaKuliah = $('#noKerjasama').select2('data')[0].biaya;
                mahasiswa.NamaUniversitas = $('#noKerjasama').select2('data')[0].nama;
                mahasiswa.NoKerjasama = $('#noKerjasama').select2('data')[0].value;
            } else {
                mahasiswa.NamaUniversitas = $("#NamaUniversitas").val();
            }
            mahasiswa.ProdiAsal = $("#prodiAsal").val();
            mahasiswa.NIMAsal = $("#nimAsal").val();
            mahasiswa.Semester = $("#tahunSemester").val();
            mahasiswa.NoHp = $("#noHp").val();
            mahasiswa.Email = $("#emailRegistrasi").val();
            mahasiswa.Password = $("#passwordRegistrasi").val();
            $.ajax({
                type: "POST",
                url: "@Url.Action("registerExternal", "Home")",
                data: mahasiswa
            }).then(function (response) {
                alert(response.message);
                if (response.status == 200) {
                    location.reload();
                }
            });
        }
        function loadNamaUniversitas() {
            $("#namaUniversitas").select2({
                placeholder: "-- Pilih Universitas --",
                width: "100%",
                ajax: {
                    url: "@Url.Action("GetNamaInstansi", "Home")",
                    dataType: 'json',
                    method: "POST",
                    delay: 250,
                    cache: false,
                    data: function (params) {
                        return {
                            Length: "10",
                            Search: params.term || "",
                            Skip: (params.page - 1) * 10 || 0,
                        };
                    },
                    processResults: function (data, params) {
                        var page = params.page - 1 || 1;
                        return {
                            results: $.map(data, function (item) { return { id: item.NoKerjasama, value: item.NoKerjasama, nama: item.NamaInstansi, text: item.NamaInstansi } }),
                            pagination: {
                                more: (page * 10) <= data.length
                            }
                        };
                    },
                }
            });
        }
        function loadNoKerjasama() {
            $("#noKerjasama").select2({
                placeholder: "-- Pilih Nomor Kerjasama --",
                width: "100%",
                ajax: {
                    url: "@Url.Action("GetNoKerjasama", "Home")",
                    dataType: 'json',
                    method: "POST",
                    delay: 250,
                    cache: false,
                    data: function (params) {
                        return {
                            Length: "10",
                            Search: params.term || "",
                            Skip: (params.page - 1) * 10 || 0,
                            NamaInstansi: $('#namaUniversitas').select2('data')[0].nama
                        };
                    },
                    processResults: function (data, params) {
                        var page = params.page - 1 || 1;
                        return {
                            results: $.map(data, function (item) { return { id: item.NoKerjasama, value: item.NoKerjasama, biaya: item.Biaya, nama: item.NamaInstansi, text: item.NoKerjasama } }),
                            pagination: {
                                more: (page * 10) <= data.length
                            }
                        };
                    },
                }
            });
        }
        function loadFromLookup(tipe, id, nama) {

            $("#" + id).select2({
                placeholder: "-- Pilih " + nama + " --",
                width: "100%",
                ajax: {
                    url: "@Url.Action("getLookupByTipe", "Home")",
                    dataType: 'json',
                    method: "POST",
                    delay: 250,
                    cache: false,
                    data: function (params) {
                        return {
                            Tipe: tipe
                        };
                    },
                    processResults: function (data, params) {
                        return {
                            results: $.map(data, function (item) { return { id: item.Nilai, value: item.Nilai, text: item.Nama } })
                        };
                    },
                }
            });
        }
        function isEmpty(id, nama) {
            if (!$("#" + id).val()) {
                alert(nama + ' tidak boleh kosong!');
                $("#" + id).focus();
                return true;
            }
            return false;
        }
    </script>
}